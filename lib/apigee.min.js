window.console=window.console||{};window.console.log=window.console.log||function(){};var Usergrid=function(){function e(){var e=[],t="0123456789ABCDEF";for(var n=0;n<36;n++)e[n]=Math.floor(Math.random()*16);e[14]=4;e[19]=e[19]&3|8;for(var n=0;n<36;n++)e[n]=t[e[n]];e[8]=e[13]=e[18]=e[23]="-";return e.join("")}function t(e){var t=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;if(!e)return false;return t.test(e)}function n(e){tail=[];var t=[];if(e instanceof Array){for(i in e){t=e[i];if(t instanceof Array&&t.length>1){tail.push(t[0]+"="+encodeURIComponent(t[1]))}}}else{for(var n in e){if(e.hasOwnProperty(n)){var r=e[n];if(r instanceof Array){for(i in r){t=r[i];tail.push(n+"="+encodeURIComponent(t))}}else{tail.push(n+"="+encodeURIComponent(r))}}}}return tail.join("&")}window.Usergrid=window.Usergrid||{};Usergrid=Usergrid||{};Usergrid.USERGRID_SDK_VERSION="0.10.06";Usergrid.Client=function(e){this.URI=e.URI||"http://apigee-internal-prod.jupiter.apigee.net";this.orgName=e.orgName;this.appName=e.appName;this.buildCurl=e.buildCurl||false;this.logging=e.logging||false;this._callTimeout=e.callTimeout||3e4;this._callTimeoutCallback=e.callTimeoutCallback||null;this.logoutCallback=e.logoutCallback||null};Usergrid.Client.prototype.request=function(e,t){var r=this;var i=e.method||"GET";var s=e.endpoint;var o=e.body||{};var u=e.qs||{};var a=e.mQuery||false;if(a){var f=this.URI+"/"+s}else{var f=this.URI+"/"+this.orgName+"/"+this.appName+"/"+s}if(r.getToken()){u["access_token"]=r.getToken()}var l=n(u);if(l){f+="?"+l}o=JSON.stringify(o);var c=new XMLHttpRequest;c.open(i,f,true);if(o){c.setRequestHeader("Content-Type","application/json");c.setRequestHeader("Accept","application/json")}c.onerror=function(){r._end=(new Date).getTime();if(r.logging){console.log("success (time: "+r.calcTimeDiff()+"): "+i+" "+f)}if(r.logging){console.log("Error: API call failed at the network level.")}clearTimeout(h);var e=true;if(typeof t==="function"){t(e,data)}};c.onload=function(e){r._end=(new Date).getTime();if(r.logging){console.log("success (time: "+r.calcTimeDiff()+"): "+i+" "+f)}clearTimeout(h);e=JSON.parse(c.responseText);if(c.status!=200){var n=e.error;var s=e.error_description;if(r.logging){console.log("Error ("+c.status+")("+n+"): "+s)}if(n=="auth_expired_session_token"||n=="unauthorized"||n=="auth_missing_credentials"||n=="auth_invalid"){if(typeof r.logoutCallback==="function"){return r.logoutCallback(true,e)}}if(typeof t==="function"){t(true,e)}}else{if(typeof t==="function"){t(false,e)}}};var h=setTimeout(function(){c.abort();if(r._callTimeoutCallback==="function"){r._callTimeoutCallback("API CALL TIMEOUT")}else{r.callback("API CALL TIMEOUT")}},r._callTimeout);if(this.logging){console.log("calling: "+i+" "+f)}if(this.buildCurl){var p={uri:f,body:o,method:i};this.buildCurlCall(p)}this._start=(new Date).getTime();c.send(o)};Usergrid.Client.prototype.createGroup=function(e,t){var n=e.getOnExist||false;var e={path:e.path,client:this,data:e};var r=new Usergrid.Group(e);r.fetch(function(e,i){var s=e&&"service_resource_not_found"===i.error||"null_pointer"===i.error||!e&&n;if(s){r.save(function(e,n){if(typeof t==="function"){t(e,r)}})}else{if(typeof t==="function"){t(e,r)}}})};Usergrid.Client.prototype.createEntity=function(e,t){var n=e.getOnExist||false;var e={client:this,data:e};var r=new Usergrid.Entity(e);r.fetch(function(i,s){var o=i&&"service_resource_not_found"===s.error||"null_pointer"===s.error||!i&&n;if(o){r.set(e.data);r.save(function(e,n){if(typeof t==="function"){t(e,r)}})}else{if(typeof t==="function"){t(i,r)}}})};Usergrid.Client.prototype.restoreEntity=function(e){var t=JSON.parse(e);var n={client:this,data:t};var r=new Usergrid.Entity(n);return r};Usergrid.Client.prototype.getEntity=function(e,t){var e={client:this,data:e};var n=new Usergrid.Entity(e);n.fetch(function(e,r){if(typeof t==="function"){t(e,n)}})};Usergrid.Client.prototype.createCollection=function(e,t){e.client=this;var n=new Usergrid.Collection(e,function(e,r){if(typeof t==="function"){t(e,n)}})};Usergrid.Client.prototype.restoreCollection=function(e){var t=JSON.parse(e);t.client=this;var n=new Usergrid.Collection(t);return n};Usergrid.Client.prototype.getFeedForUser=function(e,t){var n={method:"GET",endpoint:"users/"+e+"/feed"};this.request(n,function(e,n){if(typeof t==="function"){if(e){t(e)}else{t(e,n,n.entities)}}})};Usergrid.Client.prototype.createUserActivity=function(e,t,n){t.type="users/"+e+"/activities";var t={client:this,data:t};var r=new Usergrid.Entity(t);r.save(function(e,t){if(typeof n==="function"){n(e,r)}})};Usergrid.Client.prototype.createUserActivityWithEntity=function(e,t,n){var r=e.get("username");var i={actor:{displayName:r,uuid:e.get("uuid"),username:r,email:e.get("email"),picture:e.get("picture"),image:{duration:0,height:80,url:e.get("picture"),width:80}},verb:"post",content:t};this.createUserActivity(r,i,n)};Usergrid.Client.prototype.calcTimeDiff=function(){var e=0;var t=this._end-this._start;try{e=(t/10/60).toFixed(2)}catch(n){return 0}return e};Usergrid.Client.prototype.setToken=function(e){var t="token"+this.appName+this.orgName;this.token=e;if(typeof Storage!=="undefined"){if(e){localStorage.setItem(t,e)}else{localStorage.removeItem(t)}}};Usergrid.Client.prototype.getToken=function(){var e="token"+this.appName+this.orgName;if(this.token){return this.token}else if(typeof Storage!=="undefined"){return localStorage.getItem(e)}return null};Usergrid.Client.prototype.signup=function(e,t,n,r,i){var s=this;var o={type:"users",username:e,password:t,email:n,name:r};this.createEntity(o,i)};Usergrid.Client.prototype.login=function(e,t,n){var r=this;var i={method:"POST",endpoint:"token",body:{username:e,password:t,grant_type:"password"}};this.request(i,function(e,t){var i={};if(e&&r.logging){console.log("error trying to log user in")}else{var s={client:r,data:t.user};i=new Usergrid.Entity(s);r.setToken(t.access_token)}if(typeof n==="function"){n(e,t,i)}})};Usergrid.Client.prototype.loginFacebook=function(e,t){var n=this;var r={method:"GET",endpoint:"auth/facebook",qs:{fb_access_token:e}};this.request(r,function(e,r){var i={};if(e&&n.logging){console.log("error trying to log user in")}else{var s={client:n,data:r.user};i=new Usergrid.Entity(s);n.setToken(r.access_token)}if(typeof t==="function"){t(e,r,i)}})};Usergrid.Client.prototype.getLoggedInUser=function(e){if(!this.getToken()){e(true,null,null)}else{var t=this;var n={method:"GET",endpoint:"users/me"};this.request(n,function(n,r){if(n){if(t.logging){console.log("error trying to log user in")}if(typeof e==="function"){e(n,r,null)}}else{var i={client:t,data:r.entities[0]};var s=new Usergrid.Entity(i);if(typeof e==="function"){e(n,r,s)}}})}};Usergrid.Client.prototype.isLoggedIn=function(){if(this.getToken()){return true}return false};Usergrid.Client.prototype.logout=function(){this.setToken(null)};Usergrid.Client.prototype.buildCurlCall=function(e){var t="curl";var n=(e.method||"GET").toUpperCase();var r=e.body||{};var i=e.uri;if(n==="POST"){t+=" -X POST"}else if(n==="PUT"){t+=" -X PUT"}else if(n==="DELETE"){t+=" -X DELETE"}else{t+=" -X GET"}t+=" "+i;if(r!=='"{}"'&&n!=="GET"&&n!=="DELETE"){t+=" -d '"+r+"'"}console.log(t);return t};Usergrid.Client.prototype.registerDevice=function(e,t){if(e){var n=e.notifier+".notifier.id";var r={type:"devices",uuid:this.getDeviceUUID()};r[n]=e.deviceToken;var i={client:this,data:r};var s=new Usergrid.Entity(i);s.save(t)}else{t(true)}};Usergrid.Client.prototype.sendPushToDevice=function(e,t){if(e){var n=e.notifier;var r={type:"notifier",name:e.notifier};var i=this;this.getEntity(r,function(r,s){if(r){t(r,s)}else{var o={type:e.path};if(s.get("provider")==="google"){o["payloads"]={};o["payloads"][n]=e.message}else if(s.get("provider")==="apple"){o["payloads"]={};o["payloads"][n]={aps:{alert:e.message,sound:e.sound}}}var u={client:i,data:o};var a=new Usergrid.Entity(u);a.save(t)}})}else{t(true)}};Usergrid.Client.prototype.getDeviceUUID=function(){if(typeof window.localStorage.getItem("deviceUUID")==="string"){return window.localStorage.getItem("deviceUUID")}else{var t=e();window.localStorage.setItem("deviceUUID",t);return window.localStorage.getItem("deviceUUID")}};Usergrid.Entity=function(e){if(e){this._client=e.client;this._data=e.data||{}}};Usergrid.Entity.prototype.serialize=function(){return JSON.stringify(this._data)};Usergrid.Entity.prototype.get=function(e){if(e){return this._data[e]}else{return this._data}};Usergrid.Entity.prototype.set=function(e,t){if(typeof e==="object"){for(var n in e){this._data[n]=e[n]}}else if(typeof e==="string"){if(t===null){delete this._data[e]}else{this._data[e]=t}}else{this._data=null}};Usergrid.Entity.prototype.save=function(e){var n=this.get("type");var r="POST";if(t(this.get("uuid"))){r="PUT";n+="/"+this.get("uuid")}var i=this;var s={};var o=this.get();for(var u in o){if(u==="metadata"||u==="created"||u==="modified"||u==="type"||u==="activated"||u==="uuid"){continue}s[u]=o[u]}var a={method:r,endpoint:n,body:s};this._client.request(a,function(t,r){if(t&&i._client.logging){console.log("could not save entity");if(typeof e==="function"){return e(t,r,i)}}else{if(r.entities){if(r.entities.length){var s=r.entities[0];i.set(s)}}var u=i.get("type")==="user"&&o.oldpassword&&o.newpassword;if(u){var a={};a.oldpassword=o.oldpassword;a.newpassword=o.newpassword;var f={method:"PUT",endpoint:n+"/password",body:a};i._client.request(f,function(t,n){if(t&&i._client.logging){console.log("could not update user")}i.set("oldpassword",null);i.set("newpassword",null);if(typeof e==="function"){e(t,n,i)}})}else if(typeof e==="function"){e(t,r,i)}}})};Usergrid.Entity.prototype.fetch=function(e){var t=this.get("type");var n=this;if(this.get("uuid")){t+="/"+this.get("uuid")}else{if(t==="users"){if(this.get("username")){t+="/"+this.get("username")}else{if(typeof e==="function"){var r="cannot fetch entity, no username specified";if(n._client.logging){console.log(r)}return e(true,r,n)}}}else{if(this.get("name")){t+="/"+encodeURIComponent(this.get("name"))}else{if(typeof e==="function"){var r="cannot fetch entity, no name specified";if(n._client.logging){console.log(r)}return e(true,r,n)}}}}var i={method:"GET",endpoint:t};this._client.request(i,function(t,r){if(t&&n._client.logging){console.log("could not get entity")}else{if(r.user){n.set(r.user)}else if(r.entities){if(r.entities.length){var i=r.entities[0];n.set(i)}}}if(typeof e==="function"){e(t,r,n)}})};Usergrid.Entity.prototype.destroy=function(e){var n=this.get("type");if(t(this.get("uuid"))){n+="/"+this.get("uuid")}else{if(typeof e==="function"){var r="Error trying to delete object - no uuid specified.";if(i._client.logging){console.log(r)}e(true,r)}}var i=this;var s={method:"DELETE",endpoint:n};this._client.request(s,function(t,n){if(t&&i._client.logging){console.log("entity could not be deleted")}else{i.set(null)}if(typeof e==="function"){e(t,n)}})};Usergrid.Entity.prototype.connect=function(e,t,n){var r=this;var i=t.get("type");var s=this.getEntityId(t);if(!s){if(typeof n==="function"){var o="Error trying to delete object - no uuid specified.";if(r._client.logging){console.log(o)}n(true,o)}return}var u=this.get("type");var a=this.getEntityId(this);if(!a){if(typeof n==="function"){var o="Error in connect - no uuid specified.";if(r._client.logging){console.log(o)}n(true,o)}return}var f=u+"/"+a+"/"+e+"/"+i+"/"+s;var l={method:"POST",endpoint:f};this._client.request(l,function(e,t){if(e&&r._client.logging){console.log("entity could not be connected")}if(typeof n==="function"){n(e,t)}})};Usergrid.Entity.prototype.getEntityId=function(e){var n=false;if(t(e.get("uuid"))){n=e.get("uuid")}else{if(type==="users"){n=e.get("username")}else if(e.get("name")){n=e.get("name")}}return n};Usergrid.Entity.prototype.getConnections=function(e,t){var n=this;var r=this.get("type");var i=this.getEntityId(this);if(!i){if(typeof t==="function"){var s="Error in getConnections - no uuid specified.";if(n._client.logging){console.log(s)}t(true,s)}return}var o=r+"/"+i+"/"+e+"/";var u={method:"GET",endpoint:o};this._client.request(u,function(r,i){if(r&&n._client.logging){console.log("entity could not be connected")}n[e]={};var s=i.entities.length;for(var o=0;o<s;o++){if(i.entities[o].type==="user"){n[e][i.entities[o].username]=i.entities[o]}else{n[e][i.entities[o].name]=i.entities[o]}}if(typeof t==="function"){t(r,i,i.entities)}})};Usergrid.Entity.prototype.disconnect=function(e,t,n){var r=this;var i=t.get("type");var s=this.getEntityId(t);if(!s){if(typeof n==="function"){var o="Error trying to delete object - no uuid specified.";if(r._client.logging){console.log(o)}n(true,o)}return}var u=this.get("type");var a=this.getEntityId(this);if(!a){if(typeof n==="function"){var o="Error in connect - no uuid specified.";if(r._client.logging){console.log(o)}n(true,o)}return}var f=u+"/"+a+"/"+e+"/"+i+"/"+s;var l={method:"DELETE",endpoint:f};this._client.request(l,function(e,t){if(e&&r._client.logging){console.log("entity could not be disconnected")}if(typeof n==="function"){n(e,t)}})};Usergrid.Collection=function(e,t){if(e){this._client=e.client;this._type=e.type;this.qs=e.qs||{};this._list=e.list||[];this._iterator=e.iterator||-1;this._previous=e.previous||[];this._next=e.next||null;this._cursor=e.cursor||null;if(e.list){var n=e.list.length;for(var r=0;r<n;r++){var i=this._client.restoreEntity(e.list[r]);this._list[r]=i}}}if(t){this.fetch(t)}};Usergrid.Collection.prototype.serialize=function(){var e={};e.type=this._type;e.qs=this.qs;e.iterator=this._iterator;e.previous=this._previous;e.next=this._next;e.cursor=this._cursor;this.resetEntityPointer();var t=0;e.list=[];while(this.hasNextEntity()){var n=this.getNextEntity();e.list[t]=n.serialize();t++}e=JSON.stringify(e);return e};Usergrid.Collection.prototype.fetch=function(e){var t=this;var n=this.qs;if(this._cursor){n.cursor=this._cursor}else{delete n.cursor}var r={method:"GET",endpoint:this._type,qs:this.qs};this._client.request(r,function(n,r){if(n&&t._client.logging){console.log("error getting collection")}else{var i=r.cursor||null;t.saveCursor(i);if(r.entities){t.resetEntityPointer();var s=r.entities.length;t._list=[];for(var o=0;o<s;o++){var u=r.entities[o].uuid;if(u){var a=r.entities[o]||{};var f={type:t._type,client:t._client,uuid:u,data:a};var l=new Usergrid.Entity(f);var c=t._list.length;t._list[c]=l}}}}if(typeof e==="function"){e(n,r)}})};Usergrid.Collection.prototype.addEntity=function(e,t){var n=this;e.type=this._type;this._client.createEntity(e,function(e,r){if(!e){var i=n._list.length;n._list[i]=r}if(typeof t==="function"){t(e,r)}})};Usergrid.Collection.prototype.destroyEntity=function(e,t){var n=this;e.destroy(function(e,r){if(e){if(n._client.logging){console.log("could not destroy entity")}if(typeof t==="function"){t(e,r)}}else{n.fetch(t)}})};Usergrid.Collection.prototype.getEntityByUUID=function(e,t){var n={data:{type:this._type,uuid:e},client:this._client};var r=new Usergrid.Entity(n);r.fetch(t)};Usergrid.Collection.prototype.getFirstEntity=function(){var e=this._list.length;if(e>0){return this._list[0]}return null};Usergrid.Collection.prototype.getLastEntity=function(){var e=this._list.length;if(e>0){return this._list[e-1]}return null};Usergrid.Collection.prototype.hasNextEntity=function(){var e=this._iterator+1;var t=e>=0&&e<this._list.length;if(t){return true}return false};Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;var e=this._iterator>=0&&this._iterator<=this._list.length;if(e){return this._list[this._iterator]}return false};Usergrid.Collection.prototype.hasPrevEntity=function(){var e=this._iterator-1;var t=e>=0&&e<this._list.length;if(t){return true}return false};Usergrid.Collection.prototype.getPrevEntity=function(){this._iterator--;var e=this._iterator>=0&&this._iterator<=this._list.length;if(e){return this.list[this._iterator]}return false};Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1};Usergrid.Collection.prototype.saveCursor=function(e){if(this._next!==e){this._next=e}};Usergrid.Collection.prototype.resetPaging=function(){this._previous=[];this._next=null;this._cursor=null};Usergrid.Collection.prototype.hasNextPage=function(){return this._next};Usergrid.Collection.prototype.getNextPage=function(e){if(this.hasNextPage()){this._previous.push(this._cursor);this._cursor=this._next;this._list=[];this.fetch(e)}};Usergrid.Collection.prototype.hasPreviousPage=function(){return this._previous.length>0};Usergrid.Collection.prototype.getPreviousPage=function(e){if(this.hasPreviousPage()){this._next=null;this._cursor=this._previous.pop();this._list=[];this.fetch(e)}};Usergrid.Group=function(e,t){this._path=e.path;this._list=[];this._client=e.client;this._data=e.data||{};this._data.type="groups"};Usergrid.Group.prototype=new Usergrid.Entity;Usergrid.Group.prototype.fetch=function(e){var t=this;var n="groups/"+this._path;var r="groups/"+this._path+"/users";var i={method:"GET",endpoint:n};var s={method:"GET",endpoint:r};this._client.request(i,function(n,r){if(n){if(t._client.logging){console.log("error getting group")}if(typeof e==="function"){e(n,r)}}else{if(r.entities){var i=r.entities[0];t._data=i||{};t._client.request(s,function(n,r){if(n&&t._client.logging){console.log("error getting group users")}else{if(r.entities){var i=r.entities.length;t._list=[];for(var s=0;s<i;s++){var o=r.entities[s].uuid;if(o){var u=r.entities[s]||{};var a={type:u.type,client:t._client,uuid:o,data:u};var f=new Usergrid.Entity(a);t._list.push(f)}}}}if(typeof e==="function"){e(n,r,t._list)}})}}})};Usergrid.Group.prototype.members=function(e){if(typeof e==="function"){e(null,this._list)}};Usergrid.Group.prototype.add=function(e,t){var n=this;var e={method:"POST",endpoint:"groups/"+this._path+"/users/"+e.user.get("username")};this._client.request(e,function(e,r){if(e){if(typeof t==="function"){t(e,r,r.entities)}}else{n.fetch(t)}})};Usergrid.Group.prototype.remove=function(e,t){var n=this;var e={method:"DELETE",endpoint:"groups/"+this._path+"/users/"+e.user.get("username")};this._client.request(e,function(e,r){if(e){if(typeof t==="function"){t(e,r)}}else{n.fetch(t)}})};Usergrid.Group.prototype.feed=function(e){var t=this;var n="groups/"+this._path+"/feed";var r={method:"GET",endpoint:n};this._client.request(r,function(n,r){if(n&&t.logging){console.log("error trying to log user in")}if(typeof e==="function"){e(n,r,r.entities)}})};Usergrid.Group.prototype.createGroupActivity=function(e,t){var n=e.user;var e={actor:{displayName:n.get("username"),uuid:n.get("uuid"),username:n.get("username"),email:n.get("email"),picture:n.get("picture"),image:{duration:0,height:80,url:n.get("picture"),width:80}},verb:"post",content:e.content};e.type="groups/"+this._path+"/activities";var e={client:this._client,data:e};var r=new Usergrid.Entity(e);r.save(function(e,n){if(typeof t==="function"){t(e,r)}})};return Usergrid}();var Apigee=function(){function f(e){var t=e||{};var r={logLevel:n.assert,logMessage:t.logMessage,tag:t.tag,timeStamp:c()};o.push(r)}function l(){var e=[],t="0123456789ABCDEF";for(var n=0;n<36;n++)e[n]=Math.floor(Math.random()*16);e[14]=4;e[19]=e[19]&3|8;for(var n=0;n<36;n++)e[n]=t[e[n]];e[8]=e[13]=e[18]=e[23]="-";return e.join("")}function c(){return(new Date).getTime().toString()}function h(){if(typeof window.localStorage.getItem("uuid")===null){return window.localStorage.getItem("uuid")}else{var e=l();window.localStorage.setItem("uuid",e);return window.localStorage.getItem("uuid")}}function p(){return typeof window.device!=="undefined"}function d(){return typeof window.forge!=="undefined"}function v(){return typeof Titanium!=="undefined"}var e={get:"GET",post:"POST",put:"PUT",del:"DELETE",head:"HEAD"};var t="0.0.1";var n={verbose:"V",debug:"D",info:"I",warn:"W",error:"E",assert:"A"};var r={verbose:2,debug:3,info:4,warn:5,error:6,assert:7};var i="UNKNOWN";var s="JavaScript";var o=[];var u=[];var a=Usergrid;a.MobileAnalytics=function(e){this.orgName=e.orgName;this.appName=e.appName;this.syncOnClose=e.syncOnClose||false;this.testMode=e.testMode||false;this.URI=typeof e.URI==="undefined"?"http://apigee-internal-prod.jupiter.apigee.net":e.URI;this.syncDate=c();if(typeof e.config!=="undefined"){this.configuration=e.config;if(this.configuration.deviceLevelOverrideEnabled===true){this.deviceConfig=this.configuration.deviceLevelAppConfig}else if(this.abtestingOverrideEnabled===true){this.deviceConfig=this.configuration.abtestingAppConfig}else{this.deviceConfig=this.configuration.defaultAppConfig}}else{this.downloadConfig()}if(this.configuration!==null){var t=0;if(this.deviceConfig.samplingRate<100){t=Math.floor(Math.random()*101)}if(t<this.deviceConfig.samplingRate){this.appId=this.configuration.instaOpsApplicationId;if(this.deviceConfig.enableLogMonitoring){this.patchLoggingCalls()}var n=3e3;if(typeof this.deviceConfig.agentUploadIntervalInSeconds!=="undefined"){n=this.deviceConfig.agentUploadIntervalInSeconds*1e3}var r=this;if(!this.syncOnClose){setInterval(function(){r.prepareSync()},n)}else{if(p()){window.addEventListener("pause",function(){r.prepareSync()},false)}else if(d()){forge.event.appPaused.addListener(function(e){},function(e){console.log("Error syncing data.");console.log(e)})}else if(v()){}else{window.addEventListener("beforeunload",function(e){r.prepareSync()})}}if(this.deviceConfig.networkMonitoringEnabled){this.patchNetworkCalls(XMLHttpRequest)}window.onerror=a.MobileAnalytics.catchCrashReport}}else{console.log("Error configuration unavailable.")}};a.MobileAnalytics.prototype.downloadConfig=function(t){function s(){if(n.readyState===4){if(n.status===200){t(null,JSON.parse(n.responseText))}else{t(n.statusText)}}}var n=new XMLHttpRequest;var r=this.URI+"/"+this.orgName+"/"+this.appName+"/apm/apigeeMobileConfig";if(typeof t==="function"){n.open(e.get,r,true);n.setRequestHeader("Accept","application/json");n.setRequestHeader("Content-Type","application/json");n.onreadystatechange=onreadystatechange;n.send()}else{n.open(e.get,r,false);n.setRequestHeader("Accept","application/json");n.setRequestHeader("Content-Type","application/json");n.send();if(n.status===200){var i=JSON.parse(n.responseText);this.configuration=i;if(i.deviceLevelOverrideEnabled===true){this.deviceConfig=i.deviceLevelAppConfig}else if(this.abtestingOverrideEnabled===true){this.deviceConfig=i.abtestingAppConfig}else{this.deviceConfig=i.defaultAppConfig}}else{this.configuration=null}}};a.MobileAnalytics.prototype.sync=function(t){var n={};n.logs=t.logs;n.metrics=t.metrics;n.sessionMetrics=this.sessionMetrics;n.orgName=this.orgName;n.appName=this.appName;n.fullAppName=this.orgName+"_"+this.appName;n.instaOpsApplicationId=this.configuration.instaOpsApplicationId;n.timeStamp=c();var r=new XMLHttpRequest;var i=this.URI+"/"+this.orgName+"/"+this.appName+"/apm/apmMetrics";r.open(e.post,i,false);r.setRequestHeader("Accept","application/json");r.setRequestHeader("Content-Type","application/json");r.send(JSON.stringify(n));if(r.status===200){o=[];u=[];var s=r.responseText;console.log(s)}else{console.log("Error syncing");console.log(r.responseText)}};a.MobileAnalytics.catchCrashReport=function(e,t,n){f({tag:"CRASH",logMessage:"Error:"+e+" for url:"+t+" on line:"+n})};a.MobileAnalytics.prototype.startSession=function(){var e=this;var t={};t.timeStamp=c();t.networkCarrier=i;t.deviceCountry=i;t.batteryLevel="-100";t.networkSubType=i;t.networkCountry=i;t.sessionId=l();t.applicationVersion="1.0";t.appId=this.appId.toString();if(this.deviceConfig.locationCaptureEnabled){if(typeof navigator.geolocation!=="undefined"){navigator.geolocation.getCurrentPosition(function(t){e.sessionMetrics.latitude=t.coords.latitude;e.sessionMetrics.longitude=t.coords.longitude})}}if(p()){t.devicePlatform=window.device.platform;t.deviceOSVersion=window.device.version;if(this.deviceConfig.deviceIdCaptureEnabled){if(this.deviceConfig.obfuscateDeviceId){t.deviceId=h()}else{t.deviceId=window.device.uuid}}else{if(this.deviceConfig.obfuscateDeviceId){t.deviceId=h()}else{t.deviceId=i}}t.deviceModel=window.device.name;t.networkType=navigator.connection.type}else if(d()){var n=i;if(forge.is.ios()){n="iOS"}else if(forge.is.android()){n="Android"}t.devicePlatform=i;t.deviceOSVersion=n;if(this.deviceConfig.deviceIdCaptureEnabled){t.deviceId=h()}else{t.deviceId=i}t.deviceModel=i;t.networkType=forge.is.connection.wifi()?"WIFI":i}else if(v()){var e=this;Ti.App.addEventListener("analytics:platformMetrics",function(t){e.sessionMetrics.devicePlatform=t.name;e.sessionMetrics.deviceOSVersion=t.osname;if(e.deviceConfig.deviceIdCaptureEnabled){if(e.deviceConfig.obfuscateDeviceId){e.sessionMetrics.deviceId=h()}else{e.sessionMetrics.deviceId=t.uuid}}else{if(e.deviceConfig.obfuscateDeviceId){e.sessionMetrics.deviceId=h()}else{e.sessionMetrics.deviceId=i}}e.sessionMetrics.deviceModel=t.model;e.sessionMetrics.networkType=t.networkType})}else{if(typeof window.localStorage!=="undefined"){if(this.deviceConfig.deviceIdCaptureEnabled){t.deviceId=h()}else{t.deviceId=i}}if(typeof navigator.userAgent!=="undefined"){var r=navigator.userAgent;var s=navigator.appName;var o,u,a;if((u=r.indexOf("Opera"))!=-1){s="Opera";fullVersion=r.substring(u+6);if((u=r.indexOf("Version"))!=-1)fullVersion=r.substring(u+8)}else if((u=r.indexOf("MSIE"))!=-1){s="Microsoft Internet Explorer";fullVersion=r.substring(u+5)}else if((u=r.indexOf("Chrome"))!=-1){s="Chrome";fullVersion=r.substring(u+7)}else if((u=r.indexOf("Safari"))!=-1){s="Safari";fullVersion=r.substring(u+7);if((u=r.indexOf("Version"))!=-1)fullVersion=r.substring(u+8)}else if((u=r.indexOf("Firefox"))!=-1){s="Firefox";fullVersion=r.substring(u+8)}else if((o=r.lastIndexOf(" ")+1)<(u=r.lastIndexOf("/"))){s=r.substring(o,u);fullVersion=r.substring(u+1);if(s.toLowerCase()==s.toUpperCase()){s=navigator.appName}}if((a=fullVersion.indexOf(";"))!=-1){fullVersion=fullVersion.substring(0,a)}if((a=fullVersion.indexOf(" "))!=-1){fullVersion=fullVersion.substring(0,a)}t.devicePlatform=s;t.deviceOSVersion=fullVersion}else{t.devicePlatform=i;t.deviceOSVersion=i}if(typeof navigator.language!=="undefined"){t.localLanguage=navigator.language}}this.sessionMetrics=t;if(v()){Ti.App.fireEvent("analytics:attachReady")}};a.MobileAnalytics.prototype.patchNetworkCalls=function(e){"use strict";var t=this;var n=e.prototype.open;var r=e.prototype.send;e.prototype.open=function(e,t,r,i,s){this._method=e;this._url=t;n.call(this,e,t,r,i,s)};e.prototype.send=function(e){function a(){if(n.readyState==4){var e=t.getMonitoringURL();if(u.indexOf("/!gap_exec")===-1&&u.indexOf(e)===-1){var r=c();var o=r-i;var a={url:u,startTime:i.toString(),endTime:r.toString(),numSamples:"1",latency:o.toString(),timeStamp:i.toString(),httpStatusCode:n.status.toString(),responseDataSize:n.responseText.length.toString()};if(n.status==200){a.numErrors="0";console.log(JSON.stringify(a));t.logNetworkCall(a)}else{a.numErrors="1";t.logNetworkCall(a)}}else{console.log("ignoring network perf for url "+u)}}if(s){s()}}var n=this;var i;var s;var o=this._method;var u=this._url;if(!this.noIntercept){i=c();if(this.addEventListener){this.addEventListener("readystatechange",a,false)}else{s=this.onreadystatechange;this.onreadystatechange=a}}r.call(this,e)}};a.MobileAnalytics.prototype.patchLoggingCalls=function(){var e=this;var t=window.console;window.console={log:function(){e.logInfo({tag:"CONSOLE",logMessage:arguments[0]});t.log.apply(t,arguments)},warn:function(){e.logWarn({tag:"CONSOLE",logMessage:arguments[0]});t.warn.apply(t,arguments)},error:function(){e.logError({tag:"CONSOLE",logMessage:arguments[0]});t.error.apply(t,arguments)},assert:function(){e.logAssert({tag:"CONSOLE",logMessage:arguments[1]});t.assert.apply(t,arguments)},debug:function(){e.logDebug({tag:"CONSOLE",logMessage:arguments[0]});t.debug.apply(t,arguments)}};if(v()){var n=Ti.API;window.console.log=function(){n.info.apply(n,arguments)};Ti.API={info:function(){e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[0]});n.info.apply(n,arguments)},log:function(){var t=arguments[0];if(t==="info"){e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]})}else if(t==="warn"){e.logWarn({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]})}else if(t==="error"){e.logError({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]})}else if(t==="debug"){e.logDebug({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]})}else if(t==="trace"){e.logAssert({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]})}else{e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]})}n.log.apply(n,arguments)}}}};a.MobileAnalytics.prototype.prepareSync=function(){var e={};var t=this;if(typeof t.sessionMetrics!=="undefined"){e.sessionMetrics=t.sessionMetrics}var n=false;this.syncDate=c();if(u.length>0){n=true}if(o.length>0){n=true}e.logs=o;e.metrics=u;if(n&&!t.testMode){this.sync(e)}};a.MobileAnalytics.prototype.logMessage=function(e){var t=e||{};var n={logLevel:t.logLevel,logMessage:t.logMessage.substring(0,250),tag:t.tag,timeStamp:c()};o.push(n)};a.MobileAnalytics.prototype.logVerbose=function(e){var t=e||{};t.logLevel=n.verbose;if(this.deviceConfig.logLevelToMonitor>=r.verbose){this.logMessage(e)}};a.MobileAnalytics.prototype.logDebug=function(e){var t=e||{};t.logLevel=n.debug;if(this.deviceConfig.logLevelToMonitor>=r.debug){this.logMessage(e)}};a.MobileAnalytics.prototype.logInfo=function(e){var t=e||{};t.logLevel=n.info;if(this.deviceConfig.logLevelToMonitor>=r.info){this.logMessage(e)}};a.MobileAnalytics.prototype.logWarn=function(e){var t=e||{};t.logLevel=n.warn;if(this.deviceConfig.logLevelToMonitor>=r.warn){this.logMessage(e)}};a.MobileAnalytics.prototype.logError=function(e){var t=e||{};t.logLevel=n.error;if(this.deviceConfig.logLevelToMonitor>=r.error){this.logMessage(e)}};a.MobileAnalytics.prototype.logAssert=function(e){var t=e||{};t.logLevel=n.assert;if(this.deviceConfig.logLevelToMonitor>=r.assert){this.logMessage(e)}};a.MobileAnalytics.prototype.logNetworkCall=function(e){u.push(e)};a.MobileAnalytics.prototype.getMonitoringURL=function(){return this.URI+"/"+this.orgName+"/"+this.appName+"/apm/"};a.MobileAnalytics.prototype.getConfig=function(e){};a.MobileAnalytics.prototype.logs=function(){return o};a.MobileAnalytics.prototype.metrics=function(){return u};a.MobileAnalytics.prototype.sessionMetrics=function(){return this.sessionMetrics};a.MobileAnalytics.prototype.clearMetrics=function(){o=[];u=[]};return a}()
