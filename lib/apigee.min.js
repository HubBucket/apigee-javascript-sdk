window.console=window.console||{},window.console.log=window.console.log||function(){};var Usergrid=function(){function e(){for(var e=[],t="0123456789ABCDEF",i=0;36>i;i++)e[i]=Math.floor(16*Math.random());e[14]=4,e[19]=8|3&e[19];for(var i=0;36>i;i++)e[i]=t[e[i]];return e[8]=e[13]=e[18]=e[23]="-",e.join("")}function t(e){var t=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;return e?t.test(e):!1}function n(e){tail=[];var t=[];if(e instanceof Array)for(i in e)t=e[i],t instanceof Array&&t.length>1&&tail.push(t[0]+"="+encodeURIComponent(t[1]));else for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];if(o instanceof Array)for(i in o)t=o[i],tail.push(n+"="+encodeURIComponent(t));else tail.push(n+"="+encodeURIComponent(o))}return tail.join("&")}return window.Usergrid=window.Usergrid||{},Usergrid=Usergrid||{},Usergrid.USERGRID_SDK_VERSION="0.10.06",Usergrid.Client=function(e){this.URI=e.URI||"http://apigee-internal-prod.jupiter.apigee.net",this.orgName=e.orgName,this.appName=e.appName,this.buildCurl=e.buildCurl||!1,this.logging=e.logging||!1,this._callTimeout=e.callTimeout||3e4,this._callTimeoutCallback=e.callTimeoutCallback||null,this.logoutCallback=e.logoutCallback||null},Usergrid.Client.prototype.request=function(e,t){var i=this,o=e.method||"GET",r=e.endpoint,s=e.body||{},a=e.qs||{},l=e.mQuery||!1;if(l)var g=this.URI+"/"+r;else var g=this.URI+"/"+this.orgName+"/"+this.appName+"/"+r;i.getToken()&&(a.access_token=i.getToken());var c=n(a);c&&(g+="?"+c),s=JSON.stringify(s);var u=new XMLHttpRequest;u.open(o,g,!0),s&&(u.setRequestHeader("Content-Type","application/json"),u.setRequestHeader("Accept","application/json")),u.onerror=function(){i._end=(new Date).getTime(),i.logging&&console.log("success (time: "+i.calcTimeDiff()+"): "+o+" "+g),i.logging&&console.log("Error: API call failed at the network level."),clearTimeout(p);var e=!0;"function"==typeof t&&t(e,data)},u.onload=function(e){if(i._end=(new Date).getTime(),i.logging&&console.log("success (time: "+i.calcTimeDiff()+"): "+o+" "+g),clearTimeout(p),e=JSON.parse(u.responseText),200!=u.status){var n=e.error,r=e.error_description;if(i.logging&&console.log("Error ("+u.status+")("+n+"): "+r),("auth_expired_session_token"==n||"unauthorized"==n||"auth_missing_credentials"==n||"auth_invalid"==n)&&"function"==typeof i.logoutCallback)return i.logoutCallback(!0,e);"function"==typeof t&&t(!0,e)}else"function"==typeof t&&t(!1,e)};var p=setTimeout(function(){u.abort(),"function"===i._callTimeoutCallback?i._callTimeoutCallback("API CALL TIMEOUT"):i.callback("API CALL TIMEOUT")},i._callTimeout);if(this.logging&&console.log("calling: "+o+" "+g),this.buildCurl){var d={uri:g,body:s,method:o};this.buildCurlCall(d)}this._start=(new Date).getTime(),u.send(s)},Usergrid.Client.prototype.createGroup=function(e,t){var i=e.getOnExist||!1,e={path:e.path,client:this,data:e},n=new Usergrid.Group(e);n.fetch(function(e,o){var r=e&&"service_resource_not_found"===o.error||"null_pointer"===o.error||!e&&i;r?n.save(function(e){"function"==typeof t&&t(e,n)}):"function"==typeof t&&t(e,n)})},Usergrid.Client.prototype.createEntity=function(e,t){var i=e.getOnExist||!1,e={client:this,data:e},n=new Usergrid.Entity(e);n.fetch(function(o,r,s){var a=o&&"service_resource_not_found"===s.error||"cannot fetch entity, no name specified"===r||"null_pointer"===s.error||!o&&i;a?(n.set(e.data),n.save(function(e){"function"==typeof t&&t(e,n)})):"function"==typeof t&&t(o,n)})},Usergrid.Client.prototype.restoreEntity=function(e){var t=JSON.parse(e),i={client:this,data:t},n=new Usergrid.Entity(i);return n},Usergrid.Client.prototype.getEntity=function(e,t){var e={client:this,data:e},i=new Usergrid.Entity(e);i.fetch(function(e){"function"==typeof t&&t(e,i)})},Usergrid.Client.prototype.createCollection=function(e,t){e.client=this;var i=new Usergrid.Collection(e,function(e){"function"==typeof t&&t(e,i)})},Usergrid.Client.prototype.restoreCollection=function(e){var t=JSON.parse(e);t.client=this;var i=new Usergrid.Collection(t);return i},Usergrid.Client.prototype.getFeedForUser=function(e,t){var i={method:"GET",endpoint:"users/"+e+"/feed"};this.request(i,function(e,i){"function"==typeof t&&(e?t(e):t(e,i,i.entities))})},Usergrid.Client.prototype.createUserActivity=function(e,t,i){t.type="users/"+e+"/activities";var t={client:this,data:t},n=new Usergrid.Entity(t);n.save(function(e){"function"==typeof i&&i(e,n)})},Usergrid.Client.prototype.createUserActivityWithEntity=function(e,t,i){var n=e.get("username"),o={actor:{displayName:n,uuid:e.get("uuid"),username:n,email:e.get("email"),picture:e.get("picture"),image:{duration:0,height:80,url:e.get("picture"),width:80}},verb:"post",content:t};this.createUserActivity(n,o,i)},Usergrid.Client.prototype.calcTimeDiff=function(){var e=0,t=this._end-this._start;try{e=(t/10/60).toFixed(2)}catch(i){return 0}return e},Usergrid.Client.prototype.setToken=function(e){var t="token"+this.appName+this.orgName;this.token=e,"undefined"!=typeof Storage&&(e?localStorage.setItem(t,e):localStorage.removeItem(t))},Usergrid.Client.prototype.getToken=function(){var e="token"+this.appName+this.orgName;return this.token?this.token:"undefined"!=typeof Storage?localStorage.getItem(e):null},Usergrid.Client.prototype.signup=function(e,t,i,n,o){var r={type:"users",username:e,password:t,email:i,name:n};this.createEntity(r,o)},Usergrid.Client.prototype.login=function(e,t,i){var n=this,o={method:"POST",endpoint:"token",body:{username:e,password:t,grant_type:"password"}};this.request(o,function(e,t){var o={};if(e&&n.logging)console.log("error trying to log user in");else{var r={client:n,data:t.user};o=new Usergrid.Entity(r),n.setToken(t.access_token)}"function"==typeof i&&i(e,t,o)})},Usergrid.Client.prototype.loginFacebook=function(e,t){var i=this,n={method:"GET",endpoint:"auth/facebook",qs:{fb_access_token:e}};this.request(n,function(e,n){var o={};if(e&&i.logging)console.log("error trying to log user in");else{var r={client:i,data:n.user};o=new Usergrid.Entity(r),i.setToken(n.access_token)}"function"==typeof t&&t(e,n,o)})},Usergrid.Client.prototype.getLoggedInUser=function(e){if(this.getToken()){var t=this,i={method:"GET",endpoint:"users/me"};this.request(i,function(i,n){if(i)t.logging&&console.log("error trying to log user in"),"function"==typeof e&&e(i,n,null);else{var o={client:t,data:n.entities[0]},r=new Usergrid.Entity(o);"function"==typeof e&&e(i,n,r)}})}else e(!0,null,null)},Usergrid.Client.prototype.isLoggedIn=function(){return this.getToken()?!0:!1},Usergrid.Client.prototype.logout=function(){this.setToken(null)},Usergrid.Client.prototype.buildCurlCall=function(e){var t="curl",i=(e.method||"GET").toUpperCase(),n=e.body||{},o=e.uri;return t+="POST"===i?" -X POST":"PUT"===i?" -X PUT":"DELETE"===i?" -X DELETE":" -X GET",t+=" "+o,'"{}"'!==n&&"GET"!==i&&"DELETE"!==i&&(t+=" -d '"+n+"'"),console.log(t),t},Usergrid.Client.prototype.registerDevice=function(e,t){if(e){var i=e.notifier+".notifier.id",n={type:"devices",uuid:this.getDeviceUUID()};n[i]=e.deviceToken;var o={client:this,data:n},r=new Usergrid.Entity(o);r.save(t)}else t(!0)},Usergrid.Client.prototype.sendPushToDevice=function(e,t){if(e){var i=e.notifier,n={type:"notifier",name:e.notifier},o=this;this.getEntity(n,function(n,r){if(n)t(n,r);else{var s={type:e.path};"google"===r.get("provider")?(s.payloads={},s.payloads[i]=e.message):"apple"===r.get("provider")&&(s.payloads={},s.payloads[i]={aps:{alert:e.message,sound:e.sound}});var a={client:o,data:s},l=new Usergrid.Entity(a);l.save(t)}})}else t(!0)},Usergrid.Client.prototype.getDeviceUUID=function(){if("string"==typeof window.localStorage.getItem("deviceUUID"))return window.localStorage.getItem("deviceUUID");var t=e();return window.localStorage.setItem("deviceUUID",t),window.localStorage.getItem("deviceUUID")},Usergrid.Entity=function(e){e&&(this._client=e.client,this._data=e.data||{})},Usergrid.Entity.prototype.serialize=function(){return JSON.stringify(this._data)},Usergrid.Entity.prototype.get=function(e){return e?this._data[e]:this._data},Usergrid.Entity.prototype.set=function(e,t){if("object"==typeof e)for(var i in e)this._data[i]=e[i];else"string"==typeof e?null===t?delete this._data[e]:this._data[e]=t:this._data=null},Usergrid.Entity.prototype.save=function(e){var i=this.get("type"),n="POST";t(this.get("uuid"))&&(n="PUT",i+="/"+this.get("uuid"));var o=this,r={},s=this.get();for(var a in s)"metadata"!==a&&"created"!==a&&"modified"!==a&&"type"!==a&&"activated"!==a&&"uuid"!==a&&(r[a]=s[a]);var l={method:n,endpoint:i,body:r};this._client.request(l,function(t,n){if(t&&o._client.logging){if(console.log("could not save entity"),"function"==typeof e)return e(t,n,o)}else{if(n.entities&&n.entities.length){var r=n.entities[0];o.set(r)}var a="user"===o.get("type")&&s.oldpassword&&s.newpassword;if(a){var l={};l.oldpassword=s.oldpassword,l.newpassword=s.newpassword;var g={method:"PUT",endpoint:i+"/password",body:l};o._client.request(g,function(t,i){t&&o._client.logging&&console.log("could not update user"),o.set("oldpassword",null),o.set("newpassword",null),"function"==typeof e&&e(t,i,o)})}else"function"==typeof e&&e(t,n,o)}})},Usergrid.Entity.prototype.fetch=function(e){var t=this.get("type"),i=this;if(void 0===t){var n="cannot fetch entity, no entity type specified";return i._client.logging&&console.log(n),e(!0,n,i)}if(this.get("uuid"))t+="/"+this.get("uuid");else if("users"===t){if(this.get("username"))t+="/"+this.get("username");else if("function"==typeof e){var n="cannot fetch entity, no username specified";return i._client.logging&&console.log(n),e(!0,n,i)}}else if(this.get("name"))t+="/"+encodeURIComponent(this.get("name"));else if("function"==typeof e){var n="cannot fetch entity, no name specified";return i._client.logging&&console.log(n),e(!0,n,i)}var o={method:"GET",endpoint:t};this._client.request(o,function(t,n){if(t&&i._client.logging)console.log("could not get entity");else if(n.user)i.set(n.user);else if(n.entities&&n.entities.length){var o=n.entities[0];i.set(o)}"function"==typeof e&&e(t,n,i)})},Usergrid.Entity.prototype.destroy=function(e){var i=this.get("type");if(t(this.get("uuid")))i+="/"+this.get("uuid");else if("function"==typeof e){var n="Error trying to delete object - no uuid specified.";o._client.logging&&console.log(n),e(!0,n)}var o=this,r={method:"DELETE",endpoint:i};this._client.request(r,function(t,i){t&&o._client.logging?console.log("entity could not be deleted"):o.set(null),"function"==typeof e&&e(t,i)})},Usergrid.Entity.prototype.connect=function(e,t,i){var n=this,o=t.get("type"),r=this.getEntityId(t);if(r){var s=this.get("type"),a=this.getEntityId(this);if(a){var l=s+"/"+a+"/"+e+"/"+o+"/"+r,g={method:"POST",endpoint:l};this._client.request(g,function(e,t){e&&n._client.logging&&console.log("entity could not be connected"),"function"==typeof i&&i(e,t)})}else if("function"==typeof i){var c="Error in connect - no uuid specified.";n._client.logging&&console.log(c),i(!0,c)}}else if("function"==typeof i){var c="Error trying to delete object - no uuid specified.";n._client.logging&&console.log(c),i(!0,c)}},Usergrid.Entity.prototype.getEntityId=function(e){var i=!1;return t(e.get("uuid"))?i=e.get("uuid"):"users"===type?i=e.get("username"):e.get("name")&&(i=e.get("name")),i},Usergrid.Entity.prototype.getConnections=function(e,t){var i=this,n=this.get("type"),o=this.getEntityId(this);if(o){var r=n+"/"+o+"/"+e+"/",s={method:"GET",endpoint:r};this._client.request(s,function(n,o){n&&i._client.logging&&console.log("entity could not be connected"),i[e]={};for(var r=o.entities.length,s=0;r>s;s++)"user"===o.entities[s].type?i[e][o.entities[s].username]=o.entities[s]:i[e][o.entities[s].name]=o.entities[s];"function"==typeof t&&t(n,o,o.entities)})}else if("function"==typeof t){var a="Error in getConnections - no uuid specified.";i._client.logging&&console.log(a),t(!0,a)}},Usergrid.Entity.prototype.disconnect=function(e,t,i){var n=this,o=t.get("type"),r=this.getEntityId(t);if(r){var s=this.get("type"),a=this.getEntityId(this);if(a){var l=s+"/"+a+"/"+e+"/"+o+"/"+r,g={method:"DELETE",endpoint:l};this._client.request(g,function(e,t){e&&n._client.logging&&console.log("entity could not be disconnected"),"function"==typeof i&&i(e,t)})}else if("function"==typeof i){var c="Error in connect - no uuid specified.";n._client.logging&&console.log(c),i(!0,c)}}else if("function"==typeof i){var c="Error trying to delete object - no uuid specified.";n._client.logging&&console.log(c),i(!0,c)}},Usergrid.Collection=function(e,t){if(e&&(this._client=e.client,this._type=e.type,this.qs=e.qs||{},this._list=e.list||[],this._iterator=e.iterator||-1,this._previous=e.previous||[],this._next=e.next||null,this._cursor=e.cursor||null,e.list))for(var i=e.list.length,n=0;i>n;n++){var o=this._client.restoreEntity(e.list[n]);this._list[n]=o}t&&this.fetch(t)},Usergrid.Collection.prototype.serialize=function(){var e={};e.type=this._type,e.qs=this.qs,e.iterator=this._iterator,e.previous=this._previous,e.next=this._next,e.cursor=this._cursor,this.resetEntityPointer();var t=0;for(e.list=[];this.hasNextEntity();){var i=this.getNextEntity();e.list[t]=i.serialize(),t++}return e=JSON.stringify(e)},Usergrid.Collection.prototype.fetch=function(e){var t=this,i=this.qs;this._cursor?i.cursor=this._cursor:delete i.cursor;var n={method:"GET",endpoint:this._type,qs:this.qs};this._client.request(n,function(i,n){if(i&&t._client.logging)console.log("error getting collection");else{var o=n.cursor||null;if(t.saveCursor(o),n.entities){t.resetEntityPointer();var r=n.entities.length;t._list=[];for(var s=0;r>s;s++){var a=n.entities[s].uuid;if(a){var l=n.entities[s]||{},g={type:t._type,client:t._client,uuid:a,data:l},c=new Usergrid.Entity(g),u=t._list.length;t._list[u]=c}}}}"function"==typeof e&&e(i,n)})},Usergrid.Collection.prototype.addEntity=function(e,t){var i=this;e.type=this._type,this._client.createEntity(e,function(e,n){if(!e){var o=i._list.length;i._list[o]=n}"function"==typeof t&&t(e,n)})},Usergrid.Collection.prototype.destroyEntity=function(e,t){var i=this;e.destroy(function(e,n){e?(i._client.logging&&console.log("could not destroy entity"),"function"==typeof t&&t(e,n)):i.fetch(t)})},Usergrid.Collection.prototype.getEntityByUUID=function(e,t){var i={data:{type:this._type,uuid:e},client:this._client},n=new Usergrid.Entity(i);n.fetch(t)},Usergrid.Collection.prototype.getFirstEntity=function(){var e=this._list.length;return e>0?this._list[0]:null},Usergrid.Collection.prototype.getLastEntity=function(){var e=this._list.length;return e>0?this._list[e-1]:null},Usergrid.Collection.prototype.hasNextEntity=function(){var e=this._iterator+1,t=e>=0&&this._list.length>e;return t?!0:!1},Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;var e=this._iterator>=0&&this._iterator<=this._list.length;return e?this._list[this._iterator]:!1},Usergrid.Collection.prototype.hasPrevEntity=function(){var e=this._iterator-1,t=e>=0&&this._list.length>e;return t?!0:!1},Usergrid.Collection.prototype.getPrevEntity=function(){this._iterator--;var e=this._iterator>=0&&this._iterator<=this._list.length;return e?this.list[this._iterator]:!1},Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1},Usergrid.Collection.prototype.saveCursor=function(e){this._next!==e&&(this._next=e)},Usergrid.Collection.prototype.resetPaging=function(){this._previous=[],this._next=null,this._cursor=null},Usergrid.Collection.prototype.hasNextPage=function(){return this._next},Usergrid.Collection.prototype.getNextPage=function(e){this.hasNextPage()&&(this._previous.push(this._cursor),this._cursor=this._next,this._list=[],this.fetch(e))},Usergrid.Collection.prototype.hasPreviousPage=function(){return this._previous.length>0},Usergrid.Collection.prototype.getPreviousPage=function(e){this.hasPreviousPage()&&(this._next=null,this._cursor=this._previous.pop(),this._list=[],this.fetch(e))},Usergrid.Group=function(e){this._path=e.path,this._list=[],this._client=e.client,this._data=e.data||{},this._data.type="groups"},Usergrid.Group.prototype=new Usergrid.Entity,Usergrid.Group.prototype.fetch=function(e){var t=this,i="groups/"+this._path,n="groups/"+this._path+"/users",o={method:"GET",endpoint:i},r={method:"GET",endpoint:n};this._client.request(o,function(i,n){if(i)t._client.logging&&console.log("error getting group"),"function"==typeof e&&e(i,n);else if(n.entities){var o=n.entities[0];t._data=o||{},t._client.request(r,function(i,n){if(i&&t._client.logging)console.log("error getting group users");else if(n.entities){var o=n.entities.length;t._list=[];for(var r=0;o>r;r++){var s=n.entities[r].uuid;if(s){var a=n.entities[r]||{},l={type:a.type,client:t._client,uuid:s,data:a},g=new Usergrid.Entity(l);t._list.push(g)}}}"function"==typeof e&&e(i,n,t._list)})}})},Usergrid.Group.prototype.members=function(e){"function"==typeof e&&e(null,this._list)},Usergrid.Group.prototype.add=function(e,t){var i=this,e={method:"POST",endpoint:"groups/"+this._path+"/users/"+e.user.get("username")};this._client.request(e,function(e,n){e?"function"==typeof t&&t(e,n,n.entities):i.fetch(t)})},Usergrid.Group.prototype.remove=function(e,t){var i=this,e={method:"DELETE",endpoint:"groups/"+this._path+"/users/"+e.user.get("username")};this._client.request(e,function(e,n){e?"function"==typeof t&&t(e,n):i.fetch(t)})},Usergrid.Group.prototype.feed=function(e){var t=this,i="groups/"+this._path+"/feed",n={method:"GET",endpoint:i};this._client.request(n,function(i,n){i&&t.logging&&console.log("error trying to log user in"),"function"==typeof e&&e(i,n,n.entities)})},Usergrid.Group.prototype.createGroupActivity=function(e,t){var i=e.user,e={actor:{displayName:i.get("username"),uuid:i.get("uuid"),username:i.get("username"),email:i.get("email"),picture:i.get("picture"),image:{duration:0,height:80,url:i.get("picture"),width:80}},verb:"post",content:e.content};e.type="groups/"+this._path+"/activities";var e={client:this._client,data:e},n=new Usergrid.Entity(e);n.save(function(e){"function"==typeof t&&t(e,n)})},Usergrid}(),Apigee=function(){function e(e){var t=e||{},n={logLevel:l.assert,logMessage:t.logMessage,tag:t.tag,timeStamp:i()};u.push(n)}function t(){for(var e=[],t="0123456789ABCDEF",i=0;36>i;i++)e[i]=Math.floor(16*Math.random());e[14]=4,e[19]=8|3&e[19];for(var i=0;36>i;i++)e[i]=t[e[i]];return e[8]=e[13]=e[18]=e[23]="-",e.join("")}function i(){return""+(new Date).getTime()}function n(){if(null===typeof window.localStorage.getItem("uuid"))return window.localStorage.getItem("uuid");var e=t();return window.localStorage.setItem("uuid",e),window.localStorage.getItem("uuid")}function o(){return window.device!==void 0}function r(){return window.forge!==void 0}function s(){return"undefined"!=typeof Titanium}var a={get:"GET",post:"POST",put:"PUT",del:"DELETE",head:"HEAD"},l={verbose:"V",debug:"D",info:"I",warn:"W",error:"E",assert:"A"},g={verbose:2,debug:3,info:4,warn:5,error:6,assert:7},c="UNKNOWN",u=[],p=[],d=Usergrid;return d.CLIENT_VERSION="2.0.1",d.MonitoringClient=function(e){if(this.orgName=e.orgName,this.appName=e.appName,this.syncOnClose=e.syncOnClose||!1,this.testMode=e.testMode||!1,this.URI=e.URI===void 0?"http://apigee-internal-prod.jupiter.apigee.net":e.URI,this.syncDate=i(),e.config!==void 0?(this.configuration=e.config,this.deviceConfig=this.configuration.deviceLevelOverrideEnabled===!0?this.configuration.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?this.configuration.abtestingAppConfig:this.configuration.defaultAppConfig):this.downloadConfig(),null!==this.configuration){var t=0;if(100>this.deviceConfig.samplingRate&&(t=Math.floor(101*Math.random())),this.deviceConfig.samplingRate>t){this.appId=this.configuration.instaOpsApplicationId,this.deviceConfig.enableLogMonitoring&&this.patchLoggingCalls();var n=3e3;this.deviceConfig.agentUploadIntervalInSeconds!==void 0&&(n=1e3*this.deviceConfig.agentUploadIntervalInSeconds);var a=this;this.syncOnClose?o()?window.addEventListener("pause",function(){a.prepareSync()},!1):r()?forge.event.appPaused.addListener(function(){},function(e){console.log("Error syncing data."),console.log(e)}):s()||window.addEventListener("beforeunload",function(){a.prepareSync()}):setInterval(function(){a.prepareSync()},n),this.deviceConfig.networkMonitoringEnabled&&this.patchNetworkCalls(XMLHttpRequest),window.onerror=d.MonitoringClient.catchCrashReport}}else console.log("Error configuration unavailable.")},d.MonitoringClient.prototype.downloadConfig=function(e){var t=new XMLHttpRequest,i=this.URI+"/"+this.orgName+"/"+this.appName+"/apm/apigeeMobileConfig";if("function"==typeof e)t.open(a.get,i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=onreadystatechange,t.send();else if(t.open(a.get,i,!1),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send(),200===t.status){var n=JSON.parse(t.responseText);this.configuration=n,this.deviceConfig=n.deviceLevelOverrideEnabled===!0?n.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?n.abtestingAppConfig:n.defaultAppConfig}else this.configuration=null},d.MonitoringClient.prototype.sync=function(e){var t={};t.logs=e.logs,t.metrics=e.metrics,t.sessionMetrics=this.sessionMetrics,t.orgName=this.orgName,t.appName=this.appName,t.fullAppName=this.orgName+"_"+this.appName,t.instaOpsApplicationId=this.configuration.instaOpsApplicationId,t.timeStamp=i();var n=new XMLHttpRequest,o=this.URI+"/"+this.orgName+"/"+this.appName+"/apm/apmMetrics";if(n.open(a.post,o,!1),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t)),200===n.status){u=[],p=[];var r=n.responseText;console.log(r)}else console.log("Error syncing"),console.log(n.responseText)},d.MonitoringClient.catchCrashReport=function(t,i,n){e({tag:"CRASH",logMessage:"Error:"+t+" for url:"+i+" on line:"+n})},d.MonitoringClient.prototype.startSession=function(){var e=this,a={};if(a.timeStamp=i(),a.networkCarrier=c,a.deviceCountry=c,a.batteryLevel="-100",a.networkSubType=c,a.networkCountry=c,a.sessionId=t(),a.applicationVersion="1.0",a.appId=""+this.appId,this.deviceConfig.locationCaptureEnabled&&navigator.geolocation!==void 0&&navigator.geolocation.getCurrentPosition(function(t){e.sessionMetrics.latitude=t.coords.latitude,e.sessionMetrics.longitude=t.coords.longitude}),o())a.devicePlatform=window.device.platform,a.deviceOSVersion=window.device.version,a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?this.deviceConfig.obfuscateDeviceId?n():window.device.uuid:this.deviceConfig.obfuscateDeviceId?n():c,a.deviceModel=window.device.name,a.networkType=navigator.connection.type;else if(r()){var l=c;forge.is.ios()?l="iOS":forge.is.android()&&(l="Android"),a.devicePlatform=c,a.deviceOSVersion=l,a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?n():c,a.deviceModel=c,a.networkType=forge.is.connection.wifi()?"WIFI":c}else if(s()){var e=this;Ti.App.addEventListener("analytics:platformMetrics",function(t){e.sessionMetrics.devicePlatform=t.name,e.sessionMetrics.deviceOSVersion=t.osname,e.sessionMetrics.deviceId=e.deviceConfig.deviceIdCaptureEnabled?e.deviceConfig.obfuscateDeviceId?n():t.uuid:e.deviceConfig.obfuscateDeviceId?n():c,e.sessionMetrics.deviceModel=t.model,e.sessionMetrics.networkType=t.networkType})}else{if(window.localStorage!==void 0&&(a.deviceId=this.deviceConfig.deviceIdCaptureEnabled?n():c),navigator.userAgent!==void 0){var g,u,p,d=navigator.userAgent,f=navigator.appName;-1!=(u=d.indexOf("Opera"))?(f="Opera",fullVersion=d.substring(u+6),-1!=(u=d.indexOf("Version"))&&(fullVersion=d.substring(u+8))):-1!=(u=d.indexOf("MSIE"))?(f="Microsoft Internet Explorer",fullVersion=d.substring(u+5)):-1!=(u=d.indexOf("Chrome"))?(f="Chrome",fullVersion=d.substring(u+7)):-1!=(u=d.indexOf("Safari"))?(f="Safari",fullVersion=d.substring(u+7),-1!=(u=d.indexOf("Version"))&&(fullVersion=d.substring(u+8))):-1!=(u=d.indexOf("Firefox"))?(f="Firefox",fullVersion=d.substring(u+8)):(g=d.lastIndexOf(" ")+1)<(u=d.lastIndexOf("/"))&&(f=d.substring(g,u),fullVersion=d.substring(u+1),f.toLowerCase()==f.toUpperCase()&&(f=navigator.appName)),-1!=(p=fullVersion.indexOf(";"))&&(fullVersion=fullVersion.substring(0,p)),-1!=(p=fullVersion.indexOf(" "))&&(fullVersion=fullVersion.substring(0,p)),a.devicePlatform=f,a.deviceOSVersion=fullVersion}else a.devicePlatform=c,a.deviceOSVersion=c;navigator.language!==void 0&&(a.localLanguage=navigator.language)}this.sessionMetrics=a,s()&&Ti.App.fireEvent("analytics:attachReady")},d.MonitoringClient.prototype.patchNetworkCalls=function(e){"use strict";var t=this,n=e.prototype.open,o=e.prototype.send;e.prototype.open=function(e,t,i,o,r){this._method=e,this._url=t,n.call(this,e,t,i,o,r)},e.prototype.send=function(e){function n(){if(4==a.readyState){var e=t.getMonitoringURL();if(-1===l.indexOf("/!gap_exec")&&-1===l.indexOf(e)){var n=i(),o=n-r,g={url:l,startTime:""+r,endTime:""+n,numSamples:"1",latency:""+o,timeStamp:""+r,httpStatusCode:""+a.status,responseDataSize:""+a.responseText.length};200==a.status?(g.numErrors="0",console.log(JSON.stringify(g)),t.logNetworkCall(g)):(g.numErrors="1",t.logNetworkCall(g))}else console.log("ignoring network perf for url "+l)}s&&s()}var r,s,a=this;this._method;var l=this._url;this.noIntercept||(r=i(),this.addEventListener?this.addEventListener("readystatechange",n,!1):(s=this.onreadystatechange,this.onreadystatechange=n)),o.call(this,e)}},d.MonitoringClient.prototype.patchLoggingCalls=function(){var e=this,t=window.console;if(window.console={log:function(){e.logInfo({tag:"CONSOLE",logMessage:arguments[0]}),t.log.apply(t,arguments)},warn:function(){e.logWarn({tag:"CONSOLE",logMessage:arguments[0]}),t.warn.apply(t,arguments)},error:function(){e.logError({tag:"CONSOLE",logMessage:arguments[0]}),t.error.apply(t,arguments)},assert:function(){e.logAssert({tag:"CONSOLE",logMessage:arguments[1]}),t.assert.apply(t,arguments)},debug:function(){e.logDebug({tag:"CONSOLE",logMessage:arguments[0]}),t.debug.apply(t,arguments)}},s()){var i=Ti.API;window.console.log=function(){i.info.apply(i,arguments)},Ti.API={info:function(){e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[0]}),i.info.apply(i,arguments)},log:function(){var t=arguments[0];"info"===t?e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"warn"===t?e.logWarn({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"error"===t?e.logError({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"debug"===t?e.logDebug({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"trace"===t?e.logAssert({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):e.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}),i.log.apply(i,arguments)}}}},d.MonitoringClient.prototype.prepareSync=function(){var e={},t=this;t.sessionMetrics!==void 0&&(e.sessionMetrics=t.sessionMetrics);var n=!1;this.syncDate=i(),p.length>0&&(n=!0),u.length>0&&(n=!0),e.logs=u,e.metrics=p,n&&!t.testMode&&this.sync(e)},d.MonitoringClient.prototype.logMessage=function(e){var t=e||{},n={logLevel:t.logLevel,logMessage:t.logMessage.substring(0,250),tag:t.tag,timeStamp:i()};u.push(n)},d.MonitoringClient.prototype.logVerbose=function(e){var t=e||{};t.logLevel=l.verbose,this.deviceConfig.logLevelToMonitor>=g.verbose&&this.logMessage(e)},d.MonitoringClient.prototype.logDebug=function(e){var t=e||{};t.logLevel=l.debug,this.deviceConfig.logLevelToMonitor>=g.debug&&this.logMessage(e)},d.MonitoringClient.prototype.logInfo=function(e){var t=e||{};t.logLevel=l.info,this.deviceConfig.logLevelToMonitor>=g.info&&this.logMessage(e)},d.MonitoringClient.prototype.logWarn=function(e){var t=e||{};t.logLevel=l.warn,this.deviceConfig.logLevelToMonitor>=g.warn&&this.logMessage(e)},d.MonitoringClient.prototype.logError=function(e){var t=e||{};t.logLevel=l.error,this.deviceConfig.logLevelToMonitor>=g.error&&this.logMessage(e)},d.MonitoringClient.prototype.logAssert=function(e){var t=e||{};t.logLevel=l.assert,this.deviceConfig.logLevelToMonitor>=g.assert&&this.logMessage(e)},d.MonitoringClient.prototype.logNetworkCall=function(e){p.push(e)},d.MonitoringClient.prototype.getMonitoringURL=function(){return this.URI+"/"+this.orgName+"/"+this.appName+"/apm/"},d.MonitoringClient.prototype.getConfig=function(){},d.MonitoringClient.prototype.logs=function(){return u},d.MonitoringClient.prototype.metrics=function(){return p},d.MonitoringClient.prototype.sessionMetrics=function(){return this.sessionMetrics},d.MonitoringClient.prototype.clearMetrics=function(){u=[],p=[]},d}();