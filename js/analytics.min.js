window.console=window.console||{},window.console.log=window.console.log||function(){};var Apigee=function(){function e(e){var t=e||{},i={logLevel:s.assert,logMessage:t.logMessage,tag:t.tag,timeStamp:o()};g.push(i)}function t(){for(var e=[],t="0123456789ABCDEF",o=0;36>o;o++)e[o]=Math.floor(16*Math.random());e[14]=4,e[19]=8|3&e[19];for(var o=0;36>o;o++)e[o]=t[e[o]];return e[8]=e[13]=e[18]=e[23]="-",e.join("")}function o(){return""+(new Date).getTime()}function i(){if(null===typeof window.localStorage.getItem("uuid"))return window.localStorage.getItem("uuid");var e=t();return window.localStorage.setItem("uuid",e),window.localStorage.getItem("uuid")}var n={get:"GET",post:"POST",put:"PUT",del:"DELETE",head:"HEAD"},s={verbose:"V",debug:"D",info:"I",warn:"W",error:"E",assert:"A"},a={verbose:2,debug:3,info:4,warn:5,error:6,assert:7},r="UNKNOWN",l={},g=[],c=[];return l.MobileAnalytics=function(e){if(this.orgName=e.orgName,this.appName=e.appName,this.testMode=e.testMode||!1,this.apiUrl=e.apiUrl===void 0?"https://api.usergrid.org/":e.apiUrl,this.syncDate=o(),e.config!==void 0?(this.configuration=e.config,this.deviceConfig=this.configuration.deviceLevelOverrideEnabled===!0?this.configuration.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?this.configuration.abtestingAppConfig:this.configuration.defaultAppConfig):this.downloadConfig(),null!==this.configuration){var t=0;if(100>this.deviceConfig.samplingRate&&(t=Math.floor(101*Math.random())),this.deviceConfig.samplingRate>t){this.appId=this.configuration.instaOpsApplicationId,this.deviceConfig.enableLogMonitoring&&this.patchLoggingCalls();var i=3e3;this.deviceConfig.agentUploadIntervalInSeconds!==void 0&&(i=this.deviceConfig.agentUploadIntervalInSeconds);var n=this;setInterval(function(){var e={};n.sessionMetrics!==void 0&&(e.sessionMetrics=n.sessionMetrics);var t=!1;n.syncDate=o(),c.length>0&&(t=!0),g.length>0&&(t=!0),e.logs=g,e.metrics=c,t&&!n.testMode&&n.sync(e)},3e3),this.deviceConfig.networkMonitoringEnabled&&this.patchNetworkCalls(XMLHttpRequest),window.onerror=l.MobileAnalytics.catchCrashReport}}else console.log("Error configuration unavailable.")},l.MobileAnalytics.prototype.downloadConfig=function(e){var t=new XMLHttpRequest,o=this.apiUrl+this.orgName+"/"+this.appName+"/apm/apigeeMobileConfig";if("function"==typeof e)t.open(n.get,o,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=onreadystatechange,t.send();else if(t.open(n.get,o,!1),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send(),200===t.status){var i=JSON.parse(t.responseText);this.configuration=i,this.deviceConfig=i.deviceLevelOverrideEnabled===!0?i.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?i.abtestingAppConfig:i.defaultAppConfig}else this.configuration=null},l.MobileAnalytics.prototype.sync=function(e){var t={};t.logs=e.logs,t.metrics=e.metrics,t.sessionMetrics=this.sessionMetrics,t.orgName=this.orgName,t.appName=this.appName,t.fullAppName=this.orgName+"_"+this.appName,t.instaOpsApplicationId=this.configuration.instaOpsApplicationId,t.timeStamp=o();var i=new XMLHttpRequest,s=this.apiUrl+this.orgName+"/"+this.appName+"/apm/apmMetrics";if(i.open(n.post,s,!1),i.setRequestHeader("Accept","application/json"),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(t)),200===i.status){g=[],c=[];var a=i.responseText;console.log(a)}else console.log("Error syncing"),console.log(i.responseText)},l.MobileAnalytics.catchCrashReport=function(t,o,i){e({tag:"CRASH",logMessage:"Error:"+t+" for url:"+o+" on line:"+i})},l.MobileAnalytics.prototype.startSession=function(){var e={};if(e.timeStamp=o(),e.networkCarrier=r,e.deviceCountry=r,e.batteryLevel="-100",e.networkSubType=r,e.networkCountry=r,e.sessionId=t(),e.applicationVersion="1.0",e.appId=""+this.appId,e.sdkType="javascript",window.device!==void 0)e.devicePlatform=window.device.platform,e.deviceOperatingSystem=window.device.version,e.deviceId=this.deviceConfig.deviceIdCaptureEnabled?this.deviceConfig.obfuscateDeviceId?i():window.device.uuid:this.deviceConfig.obfuscateDeviceId?i():r,e.deviceModel=window.device.name,e.networkType=navigator.network.connection.type;else{if(window.localStorage!==void 0&&(e.deviceId=this.deviceConfig.deviceIdCaptureEnabled?i():r),navigator.userAgent!==void 0){var n=navigator.userAgent.toLowerCase(),s=r;/ipad/.test(n)?s="iPad":/iphone/.test(n)?s="iPhone":/android/.test(n)?s="Android":/webos/.test(n)&&(s="WebOS"),e.deviceOperatingSystem=s}navigator.platform!==void 0&&(e.devicePlatform=navigator.platform),navigator.language!==void 0&&(e.localLanguage=navigator.language)}this.sessionMetrics=e},l.MobileAnalytics.prototype.patchNetworkCalls=function(e){"use strict";var t=this,i=e.prototype.open,n=e.prototype.send;e.prototype.open=function(e,t,o,n,s){this._method=e,this._url=t,i.call(this,e,t,o,n,s)},e.prototype.send=function(e){function i(){if(4==r.readyState&&-1===l.indexOf("/!gap_exec")&&-1===l.indexOf(t.apiUrl)){var e=o(),i=e-s,n={url:l,startTime:""+s,endTime:""+e,numSamples:"1",latency:""+i,timeStamp:""+s,httpStatusCode:r.status,responseDataSize:r.responseText.length};200==r.status?(n.numErrors="0",console.log(JSON.stringify(n)),t.logNetworkCall(n)):(n.numErrors="1",t.logNetworkCall(n))}a&&a()}var s,a,r=this;this._method;var l=this._url;this.noIntercept||(s=o(),this.addEventListener?this.addEventListener("readystatechange",i,!1):(a=this.onreadystatechange,this.onreadystatechange=i)),n.call(this,e)}},l.MobileAnalytics.prototype.patchLoggingCalls=function(){var e=this,t=window.console;window.console={log:function(){e.logInfo({tag:"CONSOLE",logMessage:arguments[0]}),t.log.apply(t,arguments)},warn:function(){e.logWarn({tag:"CONSOLE",logMessage:arguments[0]}),t.warn.apply(t,arguments)},error:function(){e.logError({tag:"CONSOLE",logMessage:arguments[0]}),t.error.apply(t,arguments)},assert:function(){e.logAssert({tag:"CONSOLE",logMessage:arguments[1]}),t.assert.apply(t,arguments)},debug:function(){e.logDebug({tag:"CONSOLE",logMessage:arguments[0]}),t.debug.apply(t,arguments)}}},l.MobileAnalytics.prototype.logMessage=function(e){var t=e||{},i={logLevel:t.logLevel,logMessage:t.logMessage.substring(0,250),tag:t.tag,timeStamp:o()};g.push(i)},l.MobileAnalytics.prototype.logVerbose=function(e){var t=e||{};t.logLevel=s.verbose,this.deviceConfig.logLevelToMonitor>=a.verbose&&this.logMessage(e)},l.MobileAnalytics.prototype.logDebug=function(e){var t=e||{};t.logLevel=s.debug,this.deviceConfig.logLevelToMonitor>=a.debug&&this.logMessage(e)},l.MobileAnalytics.prototype.logInfo=function(e){var t=e||{};t.logLevel=s.info,this.deviceConfig.logLevelToMonitor>=a.info&&this.logMessage(e)},l.MobileAnalytics.prototype.logWarn=function(e){var t=e||{};t.logLevel=s.warn,this.deviceConfig.logLevelToMonitor>=a.warn&&this.logMessage(e)},l.MobileAnalytics.prototype.logError=function(e){var t=e||{};t.logLevel=s.error,this.deviceConfig.logLevelToMonitor>=a.error&&this.logMessage(e)},l.MobileAnalytics.prototype.logAssert=function(e){var t=e||{};t.logLevel=s.assert,this.deviceConfig.logLevelToMonitor>=a.assert&&this.logMessage(e)},l.MobileAnalytics.prototype.logNetworkCall=function(e){c.push(e)},l.MobileAnalytics.prototype.getConfig=function(){},l.MobileAnalytics.prototype.logs=function(){return g},l.MobileAnalytics.prototype.metrics=function(){return c},l.MobileAnalytics.prototype.sessionMetrics=function(){return this.sessionMetrics},l.MobileAnalytics.prototype.clearMetrics=function(){g=[],c=[]},l}();