/*! apigee-javascript-sdk@2.0.5 2014-01-02 */
!function(){var name="Usergrid",global=this,overwrittenName=global[name],Usergrid=Usergrid||global.Usergrid;if(!Usergrid)throw"Usergrid module is required for the monitoring module.";return Usergrid.client.prototype.logVerbose=function(options){this.monitor.logVerbose(options)},Usergrid.client.prototype.logDebug=function(options){this.monitor.logDebug(options)},Usergrid.client.prototype.logInfo=function(options){this.monitor.logInfo(options)},Usergrid.client.prototype.logWarn=function(options){this.monitor.logWarn(options)},Usergrid.client.prototype.logError=function(options){this.monitor.logError(options)},Usergrid.client.prototype.logAssert=function(options){this.monitor.logAssert(options)},global[name]={client:Usergrid.client,entity:Usergrid.entity,collection:Usergrid.collection,group:Usergrid.group,AUTH_CLIENT_ID:Usergrid.AUTH_CLIENT_ID,AUTH_APP_USER:Usergrid.AUTH_APP_USER,AUTH_NONE:Usergrid.AUTH_NONE},global[name].noConflict=function(){return overwrittenName&&(global[name]=overwrittenName),Usergrid},global[name]}(),function(){function logCrash(options){var log=options||{},cleansedLog={logLevel:LOGLEVELS.assert,logMessage:log.logMessage,tag:log.tag,timeStamp:timeStamp()};logs.push(cleansedLog)}function randomUUID(){var i,s=[],itoh="0123456789ABCDEF";for(i=0;36>i;i++)s[i]=Math.floor(16*Math.random());for(s[14]=4,s[19]=3&s[19]|8,i=0;36>i;i++)s[i]=itoh[s[i]];return s[8]=s[13]=s[18]=s[23]="-",s.join("")}function timeStamp(){return(new Date).getTime().toString()}function generateDeviceId(){var deviceId="UNKNOWN";try{if("undefined"==typeof localStorage)throw new Error("device or platform does not support local storage");null===window.localStorage.getItem("uuid")&&window.localStorage.setItem("uuid",randomUUID()),deviceId=window.localStorage.getItem("uuid")}catch(e){deviceId=randomUUID(),console.warn(e)}finally{return deviceId}}function isPhoneGap(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof window.device}function isTrigger(){return"undefined"!=typeof window.forge}function isTitanium(){return"undefined"!=typeof Titanium}function createBrowserRegex(browser){return new RegExp("\\b("+browser+")\\/([^\\s]+)")}function createBrowserTest(userAgent,positive,negatives){var matches=BROWSER_REGEX[positive].exec(userAgent);return negatives=negatives||[],matches&&matches.length&&!negatives.some(function(negative){return BROWSER_REGEX[negative].exec(userAgent)})?matches.slice(1,3):void 0}function determineBrowserType(ua,appName){var browserName=appName,fullVersion=UNKNOWN,browserData={devicePlatform:UNKNOWN,deviceOSVersion:UNKNOWN},browserData=BROWSER_TESTS.reduce(function(p,c){return c?c:p},"UNKNOWN");return browserName=browserData[0],fullVersion=browserData[1],"MSIE"===browserName&&(browserName="Microsoft Internet Explorer"),browserData.devicePlatform=browserName,browserData.deviceOSVersion=fullVersion,browserData}var name="Apigee",global=this,overwrittenName=global[name],Usergrid=Usergrid||global.Usergrid;if(!Usergrid)throw"Usergrid module is required for the monitoring module.";var VERBS={get:"GET",post:"POST",put:"PUT",del:"DELETE",head:"HEAD"},LOGLEVELS={verbose:"V",debug:"D",info:"I",warn:"W",error:"E",assert:"A"},LOGLEVELNUMBERS={verbose:2,debug:3,info:4,warn:5,error:6,assert:7},UNKNOWN="UNKNOWN",SDKTYPE="JavaScript",logs=[],metrics=[],Apigee=Usergrid;Apigee.prototype=Usergrid.prototype,Apigee.Client=function(options){if(this.monitoringEnabled=options.monitoringEnabled||!0,this.monitoringEnabled)try{this.monitor=new Apigee.MonitoringClient(options)}catch(e){console.log(e)}Usergrid.client.call(this,options)},Apigee.Client.prototype=Usergrid.client.prototype,Apigee.MonitoringClient=function(options){var self=this;if(this.orgName=options.orgName,this.appName=options.appName,this.syncOnClose=options.syncOnClose||!1,this.testMode=options.testMode||!1,this.URI="undefined"==typeof options.URI?"https://api.usergrid.com":options.URI,this.syncDate=timeStamp(),"undefined"!=typeof options.config?(this.configuration=options.config,this.deviceConfig=this.configuration.deviceLevelOverrideEnabled===!0?this.configuration.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?this.configuration.abtestingAppConfig:this.configuration.defaultAppConfig):(this.configuration=null,this.downloadConfig()),null!==this.configuration&&"undefined"!==this.configuration){var sampleSeed=0;if(this.deviceConfig.samplingRate<100&&(sampleSeed=Math.floor(101*Math.random())),sampleSeed<this.deviceConfig.samplingRate){this.appId=this.configuration.instaOpsApplicationId,this.appConfigType=this.deviceConfig.appConfigType,this.deviceConfig.enableLogMonitoring&&this.patchLoggingCalls();var syncIntervalMillis=3e3;"undefined"!=typeof this.deviceConfig.agentUploadIntervalInSeconds&&(syncIntervalMillis=1e3*this.deviceConfig.agentUploadIntervalInSeconds),this.syncOnClose?isPhoneGap()?window.addEventListener("pause",function(){self.prepareSync()},!1):isTrigger()?forge.event.appPaused.addListener(function(){},function(error){console.log("Error syncing data."),console.log(error)}):isTitanium()||window.addEventListener("beforeunload",function(){self.prepareSync()}):setInterval(function(){self.prepareSync()},syncIntervalMillis),this.deviceConfig.networkMonitoringEnabled&&this.patchNetworkCalls(XMLHttpRequest),window.onerror=Apigee.MonitoringClient.catchCrashReport,this.startSession(),this.sync({})}}else console.log("Error: Apigee APM configuration unavailable.")},Apigee.MonitoringClient.prototype.applyMonkeyPatches=function(){var self=this;self.deviceConfig.enableLogMonitoring&&self.patchLoggingCalls(),self.deviceConfig.networkMonitoringEnabled&&self.patchNetworkCalls(XMLHttpRequest)},Apigee.MonitoringClient.prototype.getConfig=function(options,callback){"undefined"!=typeof options.config?(this.configuration=options.config,this.deviceConfig=this.configuration.deviceLevelOverrideEnabled===!0?this.configuration.deviceLevelAppConfig:this.abtestingOverrideEnabled===!0?this.configuration.abtestingAppConfig:this.configuration.defaultAppConfig,callback(this.deviceConfig)):(this.configuration=null,this.downloadConfig(callback))},Apigee.MonitoringClient.prototype.downloadConfig=function(callback){function onReadyStateChange(){if(4===configRequest.readyState)if("function"==typeof callback)200===configRequest.status?callback(null,JSON.parse(configRequest.responseText)):callback(configRequest.statusText);else if(200===configRequest.status){var config=JSON.parse(configRequest.responseText);self.configuration=config,self.deviceConfig=config.deviceLevelOverrideEnabled===!0?config.deviceLevelAppConfig:self.abtestingOverrideEnabled===!0?config.abtestingAppConfig:config.defaultAppConfig}}var configRequest=new XMLHttpRequest,path=this.URI+"/"+this.orgName+"/"+this.appName+"/apm/apigeeMobileConfig";"function"==typeof callback?configRequest.open(VERBS.get,path,!0):configRequest.open(VERBS.get,path,!1);var self=this;configRequest.setRequestHeader("Accept","application/json"),configRequest.setRequestHeader("Content-Type","application/json"),configRequest.onreadystatechange=onReadyStateChange,configRequest.send()},Apigee.MonitoringClient.prototype.sync=function(syncObject){var syncData={};syncData.logs=syncObject.logs,syncData.metrics=syncObject.metrics,syncData.sessionMetrics=this.sessionMetrics,syncData.orgName=this.orgName,syncData.appName=this.appName,syncData.fullAppName=this.orgName+"_"+this.appName,syncData.instaOpsApplicationId=this.configuration.instaOpsApplicationId,syncData.timeStamp=timeStamp();var syncRequest=new XMLHttpRequest,path=this.URI+"/"+this.orgName+"/"+this.appName+"/apm/apmMetrics";if(syncRequest.open(VERBS.post,path,!1),syncRequest.setRequestHeader("Accept","application/json"),syncRequest.setRequestHeader("Content-Type","application/json"),syncRequest.send(JSON.stringify(syncData)),200===syncRequest.status){logs=[],metrics=[];{syncRequest.responseText}}else console.log("Error syncing"),console.log(syncRequest.responseText)},Apigee.MonitoringClient.catchCrashReport=function(crashEvent,url,line){logCrash({tag:"CRASH",logMessage:"Error:"+crashEvent+" for url:"+url+" on line:"+line})},Apigee.MonitoringClient.prototype.startLocationCapture=function(){var self=this;if(self.deviceConfig.locationCaptureEnabled&&"undefined"!=typeof navigator.geolocation){var geoSuccessCallback=function(position){self.sessionMetrics.latitude=position.coords.latitude,self.sessionMetrics.longitude=position.coords.longitude},geoErrorCallback=function(){console.log("Location access is not available.")};navigator.geolocation.getCurrentPosition(geoSuccessCallback,geoErrorCallback)}},Apigee.MonitoringClient.prototype.detectAppPlatform=function(sessionSummary){var self=this,callbackHandler_Titanium=function(e){sessionSummary.devicePlatform=e.name,sessionSummary.deviceOSVersion=e.osname,sessionSummary.deviceId=self.deviceConfig.deviceIdCaptureEnabled?self.deviceConfig.obfuscateDeviceId?generateDeviceId():e.uuid:this.deviceConfig.obfuscateDeviceId?generateDeviceId():UNKNOWN,sessionSummary.deviceModel=e.model,sessionSummary.networkType=e.networkType},callbackHandler_PhoneGap=function(){return"device"in window?(sessionSummary.devicePlatform=window.device.platform,sessionSummary.deviceOSVersion=window.device.version,sessionSummary.deviceModel=window.device.name):window.cordova&&(sessionSummary.devicePlatform=window.cordova.platformId,sessionSummary.deviceOSVersion=UNKNOWN,sessionSummary.deviceModel=UNKNOWN),"connection"in navigator&&(sessionSummary.networkType=navigator.connection.type||UNKNOWN),sessionSummary.deviceId=self.deviceConfig.deviceIdCaptureEnabled?self.deviceConfig.obfuscateDeviceId?generateDeviceId():window.device.uuid:this.deviceConfig.obfuscateDeviceId?generateDeviceId():UNKNOWN,sessionSummary},callbackHandler_Trigger=function(sessionSummary){var os=UNKNOWN;return forge.is.ios()?os="iOS":forge.is.android()&&(os="Android"),sessionSummary.devicePlatform=UNKNOWN,sessionSummary.deviceOSVersion=os,sessionSummary.deviceId=self.deviceConfig.deviceIdCaptureEnabled?generateDeviceId():UNKNOWN,sessionSummary.deviceModel=UNKNOWN,sessionSummary.networkType=forge.is.connection.wifi()?"WIFI":UNKNOWN,sessionSummary};if(isPhoneGap())sessionSummary=callbackHandler_PhoneGap(sessionSummary);else if(isTrigger())sessionSummary=callbackHandler_Trigger(sessionSummary);else if(isTitanium())Ti.App.addEventListener("analytics:platformMetrics",callbackHandler_Titanium);else if("undefined"!=typeof window.localStorage&&self.deviceConfig.deviceIdCaptureEnabled&&(sessionSummary.deviceId=generateDeviceId()),"undefined"!=typeof navigator.userAgent){var browserData=determineBrowserType(navigator.userAgent,navigator.appName);sessionSummary.devicePlatform=browserData.devicePlatform,sessionSummary.deviceOSVersion=browserData.deviceOSVersion,"undefined"!=typeof navigator.language&&(sessionSummary.localLanguage=navigator.language)}return isTitanium()&&Ti.App.fireEvent("analytics:attachReady"),sessionSummary},Apigee.MonitoringClient.prototype.startSession=function(){if(null!==this.configuration&&"undefined"!==this.configuration){var self=this,sessionSummary={};sessionSummary.timeStamp=timeStamp(),sessionSummary.appConfigType=this.appConfigType,sessionSummary.appId=this.appId.toString(),sessionSummary.applicationVersion="undefined"!=typeof this.appVersion?this.appVersion.toString():UNKNOWN,sessionSummary.batteryLevel="-100",sessionSummary.deviceCountry=UNKNOWN,sessionSummary.deviceId=UNKNOWN,sessionSummary.deviceModel=UNKNOWN,sessionSummary.deviceOSVersion=UNKNOWN,sessionSummary.devicePlatform=UNKNOWN,sessionSummary.localCountry=UNKNOWN,sessionSummary.localLanguage=UNKNOWN,sessionSummary.networkCarrier=UNKNOWN,sessionSummary.networkCountry=UNKNOWN,sessionSummary.networkSubType=UNKNOWN,sessionSummary.networkType=UNKNOWN,sessionSummary.sdkType=SDKTYPE,sessionSummary.sessionId=randomUUID(),sessionSummary.sessionStartTime=sessionSummary.timeStamp,self.startLocationCapture(),self.sessionMetrics=self.detectAppPlatform(sessionSummary)}},Apigee.MonitoringClient.prototype.patchNetworkCalls=function(XHR){"use strict";var apigee=this,open=XHR.prototype.open,send=XHR.prototype.send;XHR.prototype.open=function(method,url,async,user,pass){this._method=method,this._url=url,open.call(this,method,url,async,user,pass)},XHR.prototype.send=function(data){function onReadyStateChange(){if(4==self.readyState){var monitoringURL=apigee.getMonitoringURL();if(-1===url.indexOf("/!gap_exec")&&-1===url.indexOf(monitoringURL)){var endTime=timeStamp(),latency=endTime-startTime,summary={url:url,startTime:startTime.toString(),endTime:endTime.toString(),numSamples:"1",latency:latency.toString(),timeStamp:startTime.toString(),httpStatusCode:self.status.toString(),responseDataSize:self.responseText.length.toString()};200==self.status?(summary.numErrors="0",apigee.logNetworkCall(summary)):(summary.numErrors="1",apigee.logNetworkCall(summary))}}oldOnReadyStateChange&&oldOnReadyStateChange()}var startTime,oldOnReadyStateChange,self=this,url=(this._method,this._url);this.noIntercept||(startTime=timeStamp(),this.addEventListener?this.addEventListener("readystatechange",onReadyStateChange,!1):(oldOnReadyStateChange=this.onreadystatechange,this.onreadystatechange=onReadyStateChange)),send.call(this,data)}},Apigee.MonitoringClient.prototype.patchLoggingCalls=function(){var self=this,original=window.console;if(window.console={log:function(){self.logInfo({tag:"CONSOLE",logMessage:arguments[0]}),original.log.apply(original,arguments)},warn:function(){self.logWarn({tag:"CONSOLE",logMessage:arguments[0]}),original.warn.apply(original,arguments)},error:function(){self.logError({tag:"CONSOLE",logMessage:arguments[0]}),original.error.apply(original,arguments)},assert:function(){self.logAssert({tag:"CONSOLE",logMessage:arguments[1]}),original.assert.apply(original,arguments)},debug:function(){self.logDebug({tag:"CONSOLE",logMessage:arguments[0]}),original.debug.apply(original,arguments)}},isTitanium()){var originalTitanium=Ti.API;window.console.log=function(){originalTitanium.info.apply(originalTitanium,arguments)},Ti.API={info:function(){self.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[0]}),originalTitanium.info.apply(originalTitanium,arguments)},log:function(){var level=arguments[0];"info"===level?self.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"warn"===level?self.logWarn({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"error"===level?self.logError({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"debug"===level?self.logDebug({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):"trace"===level?self.logAssert({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}):self.logInfo({tag:"CONSOLE_TITANIUM",logMessage:arguments[1]}),originalTitanium.log.apply(originalTitanium,arguments)}}}},Apigee.MonitoringClient.prototype.prepareSync=function(){var syncObject={},self=this;"undefined"!=typeof self.sessionMetrics&&(syncObject.sessionMetrics=self.sessionMetrics);var syncFlag=!1;this.syncDate=timeStamp(),metrics.length>0&&(syncFlag=!0),logs.length>0&&(syncFlag=!0),syncObject.logs=logs,syncObject.metrics=metrics,syncFlag&&!self.testMode&&this.sync(syncObject)},Apigee.MonitoringClient.prototype.logMessage=function(options){var log=options||{},cleansedLog={logLevel:log.logLevel,logMessage:log.logMessage.substring(0,250),tag:log.tag,timeStamp:timeStamp()};logs.push(cleansedLog)},Apigee.MonitoringClient.prototype.logVerbose=function(options){var logOptions=options||{};logOptions.logLevel=LOGLEVELS.verbose,this.deviceConfig.logLevelToMonitor>=LOGLEVELNUMBERS.verbose&&this.logMessage(options)},Apigee.MonitoringClient.prototype.logDebug=function(options){var logOptions=options||{};logOptions.logLevel=LOGLEVELS.debug,this.deviceConfig.logLevelToMonitor>=LOGLEVELNUMBERS.debug&&this.logMessage(options)},Apigee.MonitoringClient.prototype.logInfo=function(options){var logOptions=options||{};logOptions.logLevel=LOGLEVELS.info,this.deviceConfig.logLevelToMonitor>=LOGLEVELNUMBERS.info&&this.logMessage(options)},Apigee.MonitoringClient.prototype.logWarn=function(options){var logOptions=options||{};logOptions.logLevel=LOGLEVELS.warn,this.deviceConfig.logLevelToMonitor>=LOGLEVELNUMBERS.warn&&this.logMessage(options)},Apigee.MonitoringClient.prototype.logError=function(options){var logOptions=options||{};logOptions.logLevel=LOGLEVELS.error,this.deviceConfig.logLevelToMonitor>=LOGLEVELNUMBERS.error&&this.logMessage(options)},Apigee.MonitoringClient.prototype.logAssert=function(options){var logOptions=options||{};logOptions.logLevel=LOGLEVELS.assert,this.deviceConfig.logLevelToMonitor>=LOGLEVELNUMBERS.assert&&this.logMessage(options)},Apigee.MonitoringClient.prototype.logNetworkCall=function(options){metrics.push(options)},Apigee.MonitoringClient.prototype.getMonitoringURL=function(){return this.URI+"/"+this.orgName+"/"+this.appName+"/apm/"},Apigee.MonitoringClient.prototype.getConfig=function(){},Apigee.MonitoringClient.prototype.logs=function(){return logs},Apigee.MonitoringClient.prototype.metrics=function(){return metrics},Apigee.MonitoringClient.prototype.getSessionMetrics=function(){return this.sessionMetrics},Apigee.MonitoringClient.prototype.clearMetrics=function(){logs=[],metrics=[]},Apigee.MonitoringClient.prototype.mixin=function(destObject){for(var props=["bind","unbind","trigger"],i=0;i<props.length;i++)destObject.prototype[props[i]]=MicroEvent.prototype[props[i]]};var BROWSER_REGEX=["Seamonkey","Firefox","Chromium","Chrome","Safari","Opera"].reduce(function(p,c){return p[c]=createBrowserRegex(c),p},{});BROWSER_REGEX.MSIE=new RegExp(";(MSIE) ([^\\s]+)");var BROWSER_TESTS=[["MSIE"],["Opera",[]],["Seamonkey",[]],["Firefox",["Seamonkey"]],["Chromium",[]],["Chrome",["Chromium"]],["Safari",["Chromium","Chrome"]]].map(function(arr){return createBrowserTest(navigator.userAgent,arr[0],arr[1])});return global[name]={Client:Apigee.Client,Entity:Apigee.entity,Collection:Apigee.collection,Group:Apigee.group,MonitoringClient:Apigee.MonitoringClient,AUTH_CLIENT_ID:Apigee.AUTH_CLIENT_ID,AUTH_APP_USER:Apigee.AUTH_APP_USER,AUTH_NONE:Apigee.AUTH_NONE},global[name].noConflict=function(){return overwrittenName&&(global[name]=overwrittenName),Apigee},global[name]}();